{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "tweakcn-switcher",
  "title": "Tweakcn Switcher",
  "description": "A component for switching shadcn/ui themes dynamically from tweakcn.com",
  "registryDependencies": [
    "button",
    "input",
    "dropdown-menu"
  ],
  "files": [
    {
      "path": "registry/tweakcn-switcher/tweakcn-switcher.tsx",
      "content": "/**\n * TweakcnSwitcher - A component for switching shadcn/ui themes\n */\n\nimport { Palette, Loader2, Plus, X, Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuLabel,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTweakcnSwitcher } from \"./use-tweakcn-switcher\";\nimport type { TweakcnSwitcherConfig } from \"./types\";\nimport { cn } from \"@/lib/utils\";\nimport { type KeyboardEvent, useState } from \"react\";\n\nexport interface TweakcnSwitcherProps extends TweakcnSwitcherConfig {\n  className?: string;\n  align?: \"start\" | \"center\" | \"end\";\n}\n\nexport function TweakcnSwitcher({ className, align = \"end\", ...config }: TweakcnSwitcherProps) {\n  const {\n    currentTheme,\n    themes,\n    isLoading,\n    error,\n    applyThemeOption,\n    addTheme,\n    removeTheme,\n    mode,\n    setMode,\n  } = useTweakcnSwitcher(config);\n\n  const [urlInput, setUrlInput] = useState(\"\");\n  const [isAddingTheme, setIsAddingTheme] = useState(false);\n  const [showUrlInput, setShowUrlInput] = useState(false);\n\n  const handleAddTheme = async () => {\n    if (!urlInput.trim()) return;\n\n    setIsAddingTheme(true);\n    try {\n      const newTheme = await addTheme(urlInput.trim());\n      if (newTheme !== null) {\n        await applyThemeOption(newTheme);\n      }\n      setUrlInput(\"\");\n      setShowUrlInput(false);\n    } catch (err) {\n      console.error(\"Failed to add theme:\", err);\n    } finally {\n      setIsAddingTheme(false);\n    }\n  };\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      handleAddTheme();\n    } else if (e.key === \"Escape\") {\n      setShowUrlInput(false);\n      setUrlInput(\"\");\n    }\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger\n        render={\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className={cn(\"relative\", className)}\n            aria-label=\"Switch theme\"\n          >\n            <Palette className=\"size-4\" />\n            {currentTheme && (\n              <span className=\"absolute -top-1 -right-1 size-2 bg-primary rounded-full\" />\n            )}\n          </Button>\n        }\n      />\n      <DropdownMenuContent align={align} className=\"w-64\">\n        <DropdownMenuGroup>\n          <DropdownMenuLabel className=\"flex items-center justify-between\">\n            <span>Themes</span>\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon-xs\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setMode(mode === \"light\" ? \"dark\" : \"light\");\n                }}\n                className=\"h-6 w-6\"\n                aria-label={`Switch to ${mode === \"light\" ? \"dark\" : \"light\"} mode`}\n              >\n                {mode === \"light\" ? <Moon className=\"size-3\" /> : <Sun className=\"size-3\" />}\n              </Button>\n            </div>\n          </DropdownMenuLabel>\n          <DropdownMenuSeparator />\n\n          {error && <div className=\"px-2 py-1.5 text-xs text-destructive\">{error}</div>}\n\n          {showUrlInput ? (\n            <div className=\"px-2 py-1.5 space-y-2\">\n              <Input\n                placeholder=\"https://tweakcn.com/r/themes/...\"\n                value={urlInput}\n                onChange={(e) => setUrlInput(e.target.value)}\n                onKeyDown={handleKeyDown}\n                className=\"h-7 text-xs\"\n                autoFocus\n              />\n              <div className=\"flex gap-1\">\n                <Button\n                  variant=\"default\"\n                  size=\"xs\"\n                  onClick={handleAddTheme}\n                  disabled={isAddingTheme || !urlInput.trim()}\n                  className=\"flex-1 h-6\"\n                >\n                  {isAddingTheme ? (\n                    <Loader2 className=\"size-3 animate-spin\" />\n                  ) : (\n                    <Plus className=\"size-3\" />\n                  )}\n                  Add\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"xs\"\n                  onClick={() => {\n                    setShowUrlInput(false);\n                    setUrlInput(\"\");\n                  }}\n                  className=\"h-6\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <>\n              {themes.length > 0 ? (\n                <DropdownMenuRadioGroup\n                  value={currentTheme?.id}\n                  onValueChange={(value) => {\n                    const theme = themes.find((t) => t.id === value);\n                    if (theme) {\n                      applyThemeOption(theme);\n                    }\n                  }}\n                >\n                  {themes.map((theme) => (\n                    <DropdownMenuRadioItem\n                      key={theme.id}\n                      value={theme.id}\n                      className=\"flex items-center justify-between group\"\n                    >\n                      <span className=\"truncate flex-1\">{theme.name}</span>\n                      {themes.length > (config.defaultThemes?.length || 0) && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon-xs\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            removeTheme(theme.id);\n                          }}\n                          className=\"h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity\"\n                          aria-label={`Remove ${theme.name}`}\n                        >\n                          <X className=\"size-3\" />\n                        </Button>\n                      )}\n                    </DropdownMenuRadioItem>\n                  ))}\n                </DropdownMenuRadioGroup>\n              ) : (\n                <div className=\"px-2 py-4 text-xs text-muted-foreground text-center\">\n                  No themes available\n                </div>\n              )}\n            </>\n          )}\n\n          {isLoading && (\n            <div className=\"px-2 py-1.5 flex items-center gap-2 text-xs text-muted-foreground\">\n              <Loader2 className=\"size-3 animate-spin\" />\n              Loading theme...\n            </div>\n          )}\n        </DropdownMenuGroup>\n\n        {!showUrlInput && (\n          <>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem onClick={() => setShowUrlInput(true)} className=\"cursor-pointer\">\n              <Plus className=\"size-4 mr-2\" />\n              Add theme from URL\n            </DropdownMenuItem>\n          </>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\n",
      "type": "registry:component"
    },
    {
      "path": "registry/tweakcn-switcher/use-tweakcn-switcher.ts",
      "content": "/**\n * Hook for managing shadcn/ui theme switching\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport type { ThemeRegistryItem, ThemeOption, TweakcnSwitcherConfig } from \"./types\";\nimport { applyThemeFromRegistry, fetchThemeFromUrl, extractThemeNameFromUrl } from \"./utils\";\n\nexport interface UseTweakcnSwitcherReturn {\n  currentTheme: ThemeOption | null;\n  themes: ThemeOption[];\n  isLoading: boolean;\n  error: string | null;\n  applyTheme: (url: string) => Promise<void>;\n  applyThemeOption: (theme: ThemeOption) => Promise<void>;\n  addTheme: (url: string, name?: string) => Promise<ThemeOption | null>;\n  removeTheme: (themeId: string) => void;\n  mode: \"light\" | \"dark\";\n  setMode: (mode: \"light\" | \"dark\") => void;\n}\n\nconst DEFAULT_STORAGE_KEY = \"tweakcn-switcher-theme\";\n\nexport function useTweakcnSwitcher(config: TweakcnSwitcherConfig = {}): UseTweakcnSwitcherReturn {\n  const { defaultThemes = [], persist = true, storageKey = DEFAULT_STORAGE_KEY } = config;\n\n  const [themes, setThemes] = useState<ThemeOption[]>(defaultThemes);\n  const [currentTheme, setCurrentTheme] = useState<ThemeOption | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [mode, setMode] = useState<\"light\" | \"dark\">(\"light\");\n  const [currentRegistryItem, setCurrentRegistryItem] = useState<ThemeRegistryItem | null>(null);\n\n  const applyTheme = useCallback(\n    async (url: string) => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const registryItem = await fetchThemeFromUrl(url);\n        setCurrentRegistryItem(registryItem);\n        applyThemeFromRegistry(registryItem, mode);\n\n        // Find or create theme option\n        const themeName = registryItem.name || extractThemeNameFromUrl(url);\n        const themeId = `theme-${themeName}`;\n\n        setThemes((prev) => {\n          let themeOption = prev.find((t) => t.url === url);\n          if (!themeOption) {\n            themeOption = {\n              id: themeId,\n              name: themeName,\n              url,\n            };\n            const updated = [...prev, themeOption];\n            setCurrentTheme(themeOption);\n            return updated;\n          }\n          setCurrentTheme(themeOption);\n          return prev;\n        });\n\n        // Persist if enabled\n        if (persist) {\n          localStorage.setItem(storageKey, JSON.stringify({ url, mode, name: themeName }));\n        }\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : \"Failed to apply theme\";\n        setError(errorMessage);\n        console.error(\"Failed to apply theme:\", err);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [mode, persist, storageKey],\n  );\n\n  // Load persisted theme on mount\n  useEffect(() => {\n    if (persist) {\n      const saved = localStorage.getItem(storageKey);\n      if (saved) {\n        try {\n          const savedTheme = JSON.parse(saved);\n          if (savedTheme.mode) {\n            setMode(savedTheme.mode);\n          }\n          if (savedTheme.url) {\n            // Apply theme after mode is set\n            setTimeout(() => {\n              applyTheme(savedTheme.url).catch(console.error);\n            }, 0);\n          }\n        } catch (e) {\n          console.error(\"Failed to load saved theme:\", e);\n        }\n      }\n    }\n  }, [persist, storageKey, applyTheme]);\n\n  // Apply mode changes to current theme\n  useEffect(() => {\n    if (currentRegistryItem) {\n      applyThemeFromRegistry(currentRegistryItem, mode);\n    }\n  }, [mode, currentRegistryItem]);\n\n  const applyThemeOption = useCallback(\n    async (theme: ThemeOption) => {\n      await applyTheme(theme.url);\n    },\n    [applyTheme],\n  );\n\n  const addTheme = useCallback(async (url: string, name?: string): Promise<ThemeOption | null> => {\n    try {\n      const registryItem = await fetchThemeFromUrl(url);\n      const themeName = name || registryItem.name || extractThemeNameFromUrl(url);\n      const themeId = `theme-${themeName}`;\n\n      const newTheme: ThemeOption = {\n        id: themeId,\n        name: themeName,\n        url,\n      };\n\n      setThemes((prev) => {\n        if (prev.some((t) => t.url === url)) {\n          return prev;\n        }\n        return [...prev, newTheme];\n      });\n\n      return newTheme;\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : \"Failed to add theme\";\n      setError(errorMessage);\n      throw err;\n    }\n  }, []);\n\n  const removeTheme = useCallback(\n    (themeId: string) => {\n      setThemes((prev) => prev.filter((t) => t.id !== themeId));\n      if (currentTheme?.id === themeId) {\n        setCurrentTheme(null);\n        setCurrentRegistryItem(null);\n        if (persist) {\n          localStorage.removeItem(storageKey);\n        }\n      }\n    },\n    [currentTheme, persist, storageKey],\n  );\n\n  return {\n    currentTheme,\n    themes,\n    isLoading,\n    error,\n    applyTheme,\n    applyThemeOption,\n    addTheme,\n    removeTheme,\n    mode,\n    setMode,\n  };\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "registry/tweakcn-switcher/types.ts",
      "content": "/**\n * Type definitions for shadcn/ui theme registry format\n */\n\nexport interface ThemeRegistryCssVars {\n  theme?: Record<string, string>;\n  light?: Record<string, string>;\n  dark?: Record<string, string>;\n}\n\nexport interface ThemeRegistryItem {\n  $schema?: string;\n  name: string;\n  type: string;\n  css?: {\n    \"@layer base\"?: Record<string, Record<string, string>>;\n  };\n  cssVars: ThemeRegistryCssVars;\n}\n\nexport interface ThemeOption {\n  id: string;\n  name: string;\n  url: string;\n  preview?: string;\n}\n\nexport interface TweakcnSwitcherConfig {\n  defaultThemes?: ThemeOption[];\n  baseUrl?: string;\n  persist?: boolean;\n  storageKey?: string;\n}\n\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/tweakcn-switcher/utils.ts",
      "content": "/**\n * Utility functions for applying theme CSS variables\n */\n\nimport type { ThemeRegistryItem } from \"./types\";\n\nfunction applyCSSVariable(\n  key: string,\n  value: string,\n  root: HTMLElement = document.documentElement,\n) {\n  const currentStyle = root.getAttribute(\"style\") || \"\";\n\n  // Remove existing variable definitions with the same name\n  const cleanedStyle = currentStyle.replace(new RegExp(`--${key}:\\\\s*[^;]+;?`, \"g\"), \"\").trim();\n\n  root.setAttribute(\"style\", `${cleanedStyle}${cleanedStyle ? \" \" : \"\"}--${key}: ${value};`);\n}\n\nexport function applyThemeFromRegistry(\n  registryItem: ThemeRegistryItem,\n  mode: \"light\" | \"dark\" = \"light\",\n) {\n  const root = document.documentElement;\n  const { cssVars, css } = registryItem;\n\n  // Apply theme-level variables (common to both light and dark)\n  if (cssVars.theme) {\n    Object.entries(cssVars.theme).forEach(([key, value]) => {\n      applyCSSVariable(key, value, root);\n    });\n  }\n\n  // Apply mode-specific variables\n  const modeVars = cssVars[mode];\n  if (modeVars) {\n    Object.entries(modeVars).forEach(([key, value]) => {\n      applyCSSVariable(key, value, root);\n    });\n  }\n\n  // Apply CSS layer base styles if present\n  if (css?.[\"@layer base\"]) {\n    // Remove existing style elements\n    const existing = document.querySelectorAll('style[data-tweakcn-switcher=\"true\"]');\n    existing.forEach((el) => el.remove());\n\n    const baseStyles = css[\"@layer base\"];\n    const styleElement = document.createElement(\"style\");\n    styleElement.setAttribute(\"data-tweakcn-switcher\", \"true\");\n\n    // Combine all selectors into one style element\n    const styleContent = Object.entries(baseStyles)\n      .map(([selector, styles]) => {\n        const props = Object.entries(styles)\n          .map(([prop, val]) => `${prop}: ${val};`)\n          .join(\" \");\n        return `${selector} { ${props} }`;\n      })\n      .join(\"\\n\");\n\n    styleElement.textContent = `@layer base {\\n${styleContent}\\n}`;\n    document.head.appendChild(styleElement);\n  }\n\n  if (mode === \"dark\") {\n    root.classList.add(\"dark\");\n  } else {\n    root.classList.remove(\"dark\");\n  }\n}\n\nexport async function fetchThemeFromUrl(url: string): Promise<ThemeRegistryItem> {\n  const response = await fetch(url);\n  if (!response.ok) {\n    throw new Error(`Failed to fetch theme: ${response.statusText}`);\n  }\n  return response.json();\n}\n\nexport function extractThemeNameFromUrl(url: string): string {\n  const match = url.match(/\\/([^/]+)\\.json$/);\n  return match ? match[1] : \"custom-theme\";\n}\n\n",
      "type": "registry:lib"
    }
  ],
  "type": "registry:component"
}